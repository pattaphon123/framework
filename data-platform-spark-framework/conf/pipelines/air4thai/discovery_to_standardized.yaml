description: 'Cleanse and standardize Air4Thai data from discovery to standardized zone.'

source:
  catalog: '${env.biglake.catalog}'
  schema: 'discovery'
  table: 'air4thai'

target:
  catalog: '${env.gcp.project_id}'
  schema: 'standardized'
  table: 'air4thai'
  description: 'Standardized Air4Thai air quality monitoring data with cleansed and validated measurements from monitoring stations across Thailand.'
  table_type: 'bigquery'
  load_type: 'merge'
  merge_keys:
    - 'station_id'
    - 'datetime_data'
  partition_columns:
    - 'data_date'
  technical_columns:
    - name: 'data_date'
      bigquery_type: 'DATE'
      description: 'Partition date for the data record'
    - name: 'load_timestamp'
      bigquery_type: 'TIMESTAMP'
      description: 'Timestamp when the record was loaded into the table'
  columns:
    - name: 'station_id'
      source_column: 'stationID'
      type: 'string'
      bigquery_type: 'STRING'
      description: 'Unique identifier for the air quality monitoring station'
      transformations:
        - type: 'trim'
    - name: 'datetime_data'
      source_column: 'DATETIMEDATA'
      type: 'timestamp'
      bigquery_type: 'TIMESTAMP'
      description: 'Date and time when the measurement was taken'
      transformations:
        - type: 'to_timestamp'
          format: 'yyyy-MM-dd HH:mm:ss'
    - name: 'pm25'
      source_column: 'PM25'
      type: 'double'
      bigquery_type: 'FLOAT64'
      description: 'Particulate matter 2.5 micrometers or smaller in diameter (μg/m³)'
    - name: 'pm10'
      source_column: 'PM10'
      type: 'double'
      bigquery_type: 'FLOAT64'
      description: 'Particulate matter 10 micrometers or smaller in diameter (μg/m³)'
    - name: 'o3'
      source_column: 'O3'
      type: 'double'
      bigquery_type: 'FLOAT64'
      description: 'Ozone concentration (ppb)'
    - name: 'co'
      source_column: 'CO'
      type: 'double'
      bigquery_type: 'FLOAT64'
      description: 'Carbon monoxide concentration (ppm)'
    - name: 'no2'
      source_column: 'NO2'
      type: 'double'
      bigquery_type: 'FLOAT64'
      description: 'Nitrogen dioxide concentration (ppb)'
    - name: 'so2'
      source_column: 'SO2'
      type: 'double'
      bigquery_type: 'FLOAT64'
      description: 'Sulfur dioxide concentration (ppb)'
    - name: 'wind_speed'
      source_column: 'WS'
      type: 'double'
      bigquery_type: 'FLOAT64'
      description: 'Wind speed (m/s)'
    - name: 'wind_direction'
      source_column: 'WD'
      type: 'double'
      bigquery_type: 'FLOAT64'
      description: 'Wind direction in degrees (0-360)'
    - name: 'temperature'
      source_column: 'TEMP'
      type: 'double'
      bigquery_type: 'FLOAT64'
      description: 'Air temperature in Celsius'
    - name: 'relative_humidity'
      source_column: 'RH'
      type: 'double'
      bigquery_type: 'FLOAT64'
      description: 'Relative humidity percentage (0-100)'
    - name: 'barometric_pressure'
      source_column: 'BP'
      type: 'double'
      bigquery_type: 'FLOAT64'
      description: 'Barometric pressure (hPa)'
    - name: 'rainfall'
      source_column: 'RAIN'
      type: 'double'
      bigquery_type: 'FLOAT64'
      description: 'Rainfall amount (mm)'
  quality_checks:
    - type: 'not_null'
      column: 'station_id'
      on_fail: 'FAIL'
    - type: 'not_null'
      column: 'datetime_data'
      on_fail: 'FAIL'
    - type: 'value_in_range'
      column: 'pm25'
      min_value: 0
      max_value: 1000
      on_fail: 'WARN'
    - type: 'value_in_range'
      column: 'pm10'
      min_value: 0
      max_value: 1000
      on_fail: 'WARN'
    - type: 'value_in_range'
      column: 'temperature'
      min_value: -50
      max_value: 60
      on_fail: 'WARN'
    - type: 'value_in_range'
      column: 'relative_humidity'
      min_value: 0
      max_value: 100
      on_fail: 'WARN'
