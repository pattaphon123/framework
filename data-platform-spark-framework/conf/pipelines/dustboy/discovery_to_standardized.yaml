description: 'Cleanse and standardize Dustboy data from discovery to standardized zone.'

source:
  catalog: '${env.biglake.catalog}'
  schema: 'discovery'
  table: 'dustboy'

target:
  catalog: '${env.gcp.project_id}'
  schema: 'standardized'
  table: 'dustboy'
  table_type: 'bigquery'
  load_type: 'merge'
  merge_keys:
    - 'dustboy_id'
    - 'log_datetime'
  partition_columns:
    - 'data_date'
  technical_columns:
    - name: 'data_date'
      bigquery_type: 'DATE'
    - name: 'load_timestamp'
      bigquery_type: 'TIMESTAMP'
  columns:
    - name: 'id'
      source_column: 'id'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'dustboy_id'
      source_column: 'dustboy_id'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'dustboy_project'
      source_column: 'dustboy_project'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'dustboy_uri'
      source_column: 'dustboy_uri'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'dustboy_name'
      source_column: 'dustboy_name'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'dustboy_name_en'
      source_column: 'dustboy_name_en'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'dustboy_lat'
      source_column: 'dustboy_lat'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'dustboy_lon'
      source_column: 'dustboy_lon'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'pm10'
      source_column: 'pm10'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'pm25'
      source_column: 'pm25'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'wind_speed'
      source_column: 'wind_speed'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'wind_direction'
      source_column: 'wind_direction'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'atmospheric'
      source_column: 'atmospheric'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'pm10_th_aqi'
      source_column: 'pm10_th_aqi'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'pm10_us_aqi'
      source_column: 'pm10_us_aqi'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'pm25_th_aqi'
      source_column: 'pm25_th_aqi'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'pm25_us_aqi'
      source_column: 'pm25_us_aqi'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'temp'
      source_column: 'temp'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'humid'
      source_column: 'humid'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'us_aqi'
      source_column: 'us_aqi'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'us_color'
      source_column: 'us_color'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'us_dustboy_icon'
      source_column: 'us_dustboy_icon'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'us_title'
      source_column: 'us_title'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'us_title_en'
      source_column: 'us_title_en'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'us_caption'
      source_column: 'us_caption'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'us_caption_en'
      source_column: 'us_caption_en'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'th_aqi'
      source_column: 'th_aqi'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'th_color'
      source_column: 'th_color'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'th_dustboy_icon'
      source_column: 'th_dustboy_icon'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'th_title'
      source_column: 'th_title'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'th_title_en'
      source_column: 'th_title_en'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'th_caption'
      source_column: 'th_caption'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'th_caption_en'
      source_column: 'th_caption_en'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'daily_pm10'
      source_column: 'daily_pm10'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'daily_pm10_th_aqi'
      source_column: 'daily_pm10_th_aqi'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'daily_pm10_us_aqi'
      source_column: 'daily_pm10_us_aqi'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'daily_pm25'
      source_column: 'daily_pm25'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'daily_pm25_th_aqi'
      source_column: 'daily_pm25_th_aqi'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'daily_pm25_us_aqi'
      source_column: 'daily_pm25_us_aqi'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'daily_th_title'
      source_column: 'daily_th_title'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'daily_th_title_en'
      source_column: 'daily_th_title_en'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'daily_us_title'
      source_column: 'daily_us_title'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'daily_us_title_en'
      source_column: 'daily_us_title_en'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'daily_th_caption'
      source_column: 'daily_th_caption'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'daily_th_caption_en'
      source_column: 'daily_th_caption_en'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'daily_us_caption'
      source_column: 'daily_us_caption'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'daily_us_caption_en'
      source_column: 'daily_us_caption_en'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'daily_th_color'
      source_column: 'daily_th_color'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'daily_us_color'
      source_column: 'daily_us_color'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'daily_th_dustboy_icon'
      source_column: 'daily_th_dustboy_icon'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'daily_us_dustboy_icon'
      source_column: 'daily_us_dustboy_icon'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'daily_temp'
      source_column: 'daily_temp'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'daily_humid'
      source_column: 'daily_humid'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'daily_wind_speed'
      source_column: 'daily_wind_speed'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'daily_wind_direction'
      source_column: 'daily_wind_direction'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'daily_atmospheric'
      source_column: 'daily_atmospheric'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'province_id'
      source_column: 'province_id'
      type: 'string'
      bigquery_type: 'STRING'
      transformations:
        - type: 'trim'
    - name: 'log_datetime'
      source_column: 'log_datetime'
      type: 'timestamp'
      bigquery_type: 'TIMESTAMP'
      transformations:
        - type: 'to_timestamp'
          format: 'yyyy-MM-dd HH:mm:ss'
  quality_checks:
    - type: 'not_null'
      column: 'id'
      on_fail: 'FAIL'
    - type: 'not_null'
      column: 'dustboy_id'
      on_fail: 'FAIL'
    - type: 'not_null'
      column: 'log_datetime'
      on_fail: 'FAIL'
    - type: 'value_in_range'
      column: 'pm10'
      min_value: 0
      max_value: 1000
      on_fail: 'WARN'
    - type: 'value_in_range'
      column: 'pm25'
      min_value: 0
      max_value: 1000
      on_fail: 'WARN'
    - type: 'value_in_range'
      column: 'dustboy_lat'
      min_value: -90
      max_value: 90
      on_fail: 'WARN'
    - type: 'value_in_range'
      column: 'dustboy_lon'
      min_value: -180
      max_value: 180
      on_fail: 'WARN'
    - type: 'value_in_range'
      column: 'temp'
      min_value: -50
      max_value: 60
      on_fail: 'WARN'
    - type: 'value_in_range'
      column: 'humid'
      min_value: 0
      max_value: 100
      on_fail: 'WARN'

