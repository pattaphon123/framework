description: 'Transform AirBKK data from discovery to standardized zone.'

source:
  catalog: '${env.biglake.catalog}'
  schema: 'discovery'
  table: 'airbkk'

target:
  catalog: '${env.gcp.project_id}'
  schema: 'standardized'
  table: 'airbkk'
  table_type: 'bigquery'
  load_type: 'partition_overwrite'
  partition_columns:
    - 'data_date'
  technical_columns:
    - name: 'data_date'
      bigquery_type: 'DATE'
    - name: 'load_timestamp'
      bigquery_type: 'TIMESTAMP'
  columns:
    - name: 'station_id'
      source_column: 'station_id'
      type: 'string'
      bigquery_type: 'STRING'
    - name: 'datetime'
      source_column: 'Date_Time'
      type: 'timestamp'
      bigquery_type: 'TIMESTAMP'
      transformations:
        - type: 'to_timestamp'
          format: 'yyyy-MM-dd HH:mm:ss'
    - name: 'pm10'
      source_column: 'PM10'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'pm25'
      source_column: 'PM2_5'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'co'
      source_column: 'CO'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'no2'
      source_column: 'NO2'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'o3'
      source_column: 'O3'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'wind_speed'
      source_column: 'WS'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'wind_direction'
      source_column: 'WD'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'temperature'
      source_column: 'Temp'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'relative_humidity'
      source_column: 'RH'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'air_pressure'
      source_column: 'BP'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'rain'
      source_column: 'RAIN'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'latitude'
      source_column: 'Latitude'
      type: 'double'
      bigquery_type: 'FLOAT64'
    - name: 'longitude'
      source_column: 'Longitude'
      type: 'double'
      bigquery_type: 'FLOAT64'
  quality_checks:
    - type: 'not_null'
      column: 'station_id'
      on_fail: 'FAIL'
    - type: 'not_null'
      column: 'datetime'
      on_fail: 'FAIL'
